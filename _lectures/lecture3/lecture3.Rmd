---
title: "Lecture 3"
description: |
  ... in which we explore the concept of Tidy Data, discover powerfull
  tools from functional programming to automate tedious tasks and fit
  out first linear models.
draft: true
author:
  - name: Jannik Buhr 
    url: https://jmbuhr.de
date: 11-02-2020
output:
  distill::distill_article:
    self_contained: false
    toc: true
categories:
  - lecture
bibliography: ["../../references.bib"]
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)
```

# Video

Watch today's video here:

<iframe height="400" src="https://www.youtube.com/embed/teusAoZ0IxI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

# Slides

Hover over the slides and press **f** for full screen. Press **?** for a list of keyboard shortcuts.

```{r}
knitr::include_url("slides3.html")
```

# Script

## Tidy data

There is one concept which also lends it's name to the tidyverse that I want to talk about. **Tidy Data** is a way of turning your datasets into a uniform shape. This makes it easier to develop and work with tools because we get a consistent interface. Once you know how to turn any dataset into a tidy dataset, you are on home turf and can express your ideas more fluently in code. Getting there can sometimes be tricky, but I will give you the most important tools. Because...

> »Happy families are all alike;<br> every unhappy family is unhappy in its own way.«<br> --- Leo Tolstoy

> »Tidy datasets are all alike,<br> but every messy dataset is messy in its own way.«<br> --- Hadley Wickham

So, how can we recognize tidy data?

Before I give you the definition, we can look at some example
tibbles that are included with the `tidyr` package (in the tidyverse).
table1, table2, table3, table4a, table4b,
and table5 all display the number of TB cases documented by
the World Health Organization in Afghanistan, Brazil,
and China between 1999 and 2000.
One of theses is in the tidy format, the others are not:

```{r}
library(tidyverse)

# The kable function from the knitr package prints the tables
# for the rmarkdown output format
kable(table1)
```


```{r}
kable(table2)
```

```{r}
kable(table3)
```

```{r}
kable(table4a)
```

```{r}
kable(table4b)
```


(ref:tidy) Figure from <https://r4ds.had.co.nz/tidy-data.html> [@wickhamDataScienceImport2017]

```{r tidy-definition, fig.cap="(ref:tidy)", out.extra="class=external", echo=FALSE}
include_graphics("img/tidy-data-wickham.png")
```

In tidy data, each variable (feature) forms it's own column. Each observation forms a row. And each cell is a single value (measurement).

The `tidyr` package contained in the tidyverse provides small example datasets to demonstrate what this means in practice. Hadley Wickham and Garrett Grolemund use these in their book as well (<https://r4ds.had.co.nz/tidy-data.html>)[@wickhamDataScienceImport2017].

### Making Data Tidy

with the `tidyr` package.

TODO: not mentioned: data that is better in another format, matrices, matrix math, arrays

## Iteration

### Reading in Multiple Files

```{r}
read_csv("data/Africa.csv")

paths <- dir("data", full.names = TRUE)
names(paths) <- basename(paths) %>% str_remove("\\.csv")

my_data <- map(paths, read_csv)

combinded_data <- my_data %>% 
  bind_rows(.id = "continent")
```

```{r}
gapminder <- map_dfr(paths, read_csv, .id = "continent")
```

```{r}
results <- vector("list", length(paths))
for (i in 1:length(paths)) {
  data <- read_csv(paths[i])
  data$continent <- names(paths[1])
  results[[i]] <- data
}

dataset <- bind_rows(results)
dataset
```


## TODO

- tidy data
    - definition
    - table1 to table4
    - advantages
        - uniformity, learning tools
        - vectorisation
    - reasons for untidy data
        - data entry
    - [https://tidyr.tidyverse.org/](https://tidyr.tidyverse.org/)
    - `billboard` data
- iteration
    - usecase 1: reading multiple files
        - split gapminder set
    - the tidy way
    - imperative vs functional programming style
    - the imperative way: for loops
    - "Of course someone has to write for-loops.
    It doesn't have to be you."
    --- Jenny Bryan
- Advanced `dplyr`
    - `across`
- pure functions and safer code
    - demonstrate global state and problems
    - define a side effect, show pure functions
    - benefits of pure functions and debugging
- linear models
    - a single linar model
    - many models
- summary statistics (gapminder)


# Exercises

# Solutions

# Resources
